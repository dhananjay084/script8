(function () {
  const AFFILIATE_LINK =
    "https://app.partnerboost.com/track/29866z0tk04zwPKxMm_bVwZdLOwuG6H3h3sX4TgcJrHgNld_b1JCnAeMJ334rnUcQApgKei4zo5MrmFNcP3enA";
  const COOKIES = [
    { name: "pbtid", value: "pb_jz2hki", days: 10 },
    { name: "utm_source", value: "PartnerBoost", days: 10 },
    { name: "utm_medium", value: "affiliate", days: 10 },
    { name: "utm_campaign", value: "450970", days: 10 },
    { name: "utm_content", value: "0", days: 10 }
    // { name: "userType", value: "guest", days: 5 }
  ];

  /* ===============================
     IST TIME CHECK (4:00 PM ‚Äì 5:00 PM)
  =============================== */
  function isAllowedISTTime() {
    const now = new Date(
      new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
    );
  
    const minutes = now.getHours() * 60 + now.getMinutes();
  
    // 1:45 AM = 105
    // 2:45 AM = 165
    return minutes >= 105 && minutes < 165;
  }
  
  if (!isAllowedISTTime()) return;
  




  /* ===============================
     COOKIE HELPERS
  =============================== */
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + days * 86400000);
    document.cookie =
      name +
      "=" +
      value +
      "; path=/; expires=" +
      d.toUTCString() +
      "; SameSite=Lax";
  }

  function getCookie(name) {
    const match = document.cookie.match(
      new RegExp("(^| )" + name + "=([^;]+)")
    );
    return match ? match[2] : null;
  }

  function hasClicked() {
    return getCookie(COOKIES[0].name) === COOKIES[0].value;
  }

  function markClicked() {
    COOKIES.forEach((c) => setCookie(c.name, c.value, c.days));
  }

  /* ===============================
     SAME TAB + NO REFERRER (LINK)
  =============================== */
  function redirectViaLink() {
    if (hasClicked()) return;

    const a = document.createElement("a");
    a.href = AFFILIATE_LINK;
    a.rel = "noreferrer"; // üö´ no referrer
    a.style.display = "none";

    document.body.appendChild(a);
    a.click(); // same-tab navigation
    document.body.removeChild(a);

    markClicked();
  }

  /* ===============================
     IFRAME FIRST ‚Üí LINK FALLBACK
  =============================== */
  function fireAffiliate() {
    if (hasClicked()) return;

    let iframeLoaded = false;
    let fallbackTriggered = false;

    const iframe = document.createElement("iframe");
    iframe.src = AFFILIATE_LINK;
    iframe.referrerPolicy = "no-referrer"; // üö´ no referrer
    iframe.style.cssText =
      "width:1px;height:1px;position:absolute;left:-9999px;border:0;visibility:hidden";

    iframe.onload = function () {
      iframeLoaded = true;
      markClicked();
    };

    iframe.onerror = function () {
      triggerFallback();
    };

    document.body.appendChild(iframe);

    // Fallback after 1 second if iframe didn‚Äôt load
    function triggerFallback() {
      if (iframeLoaded || fallbackTriggered) return;
      fallbackTriggered = true;

      setTimeout(() => {
        redirectViaLink();
      }, 1000); // ‚è±Ô∏è 1 second after landing
    }

    setTimeout(triggerFallback, 1000);
  }

  /* ===============================
     DOM READY
  =============================== */
  function init() {
    fireAffiliate();
  }

  if (document.readyState !== "loading") {
    init();
  } else {
    document.addEventListener("DOMContentLoaded", init);
  }
})();
